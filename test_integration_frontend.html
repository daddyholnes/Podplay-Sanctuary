<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MamaBear Integration Workbench</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: #161616;
            color: #f0f0f0;
        }
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background: linear-gradient(135deg, #7928ca, #ff0080);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        h1 {
            margin: 0;
            font-size: 24px;
            color: white;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }
        .tab {
            padding: 10px 15px;
            background: #222;
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            border: none;
            color: #ccc;
            font-weight: 500;
        }
        .tab.active {
            background: linear-gradient(135deg, #7928ca, #ff0080);
            color: white;
        }
        .content {
            background: #222;
            border-radius: 8px;
            padding: 20px;
            min-height: 300px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #ccc;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #444;
            background: #333;
            color: #f0f0f0;
            font-size: 14px;
        }
        button {
            background: linear-gradient(135deg, #7928ca, #ff0080);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }
        button:hover {
            opacity: 0.9;
        }
        .platform-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        .platform-card {
            background: #333;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .platform-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .platform-icon {
            width: 40px;
            height: 40px;
            background: #444;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            font-size: 20px;
        }
        .connected {
            background: linear-gradient(135deg, #7928ca, #ff0080);
        }
        .platform-name {
            font-weight: 500;
            margin-bottom: 5px;
        }
        .platform-status {
            font-size: 12px;
            color: #aaa;
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 4px solid #7928ca;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .knowledge-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .knowledge-item {
            background: #333;
            border-radius: 8px;
            padding: 15px;
        }
        .knowledge-name {
            font-weight: 500;
            margin-bottom: 5px;
        }
        .knowledge-url {
            color: #9370DB;
            margin-bottom: 5px;
            font-size: 14px;
        }
        .knowledge-date {
            font-size: 12px;
            color: #aaa;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const IntegrationWorkbench = () => {
            const [activeTab, setActiveTab] = useState('scraper');
            const [scrapingUrl, setScrapingUrl] = useState('');
            const [scrapeStatus, setScrapeStatus] = useState('');
            const [platforms, setPlatforms] = useState([]);
            const [knowledgeSources, setKnowledgeSources] = useState([]);
            const [workflowDescription, setWorkflowDescription] = useState('');
            const [loading, setLoading] = useState(false);

            useEffect(() => {
                // Load platforms when the component mounts or when the platforms tab is selected
                if (activeTab === 'platforms') {
                    fetchPlatforms();
                } else if (activeTab === 'knowledge') {
                    fetchKnowledgeSources();
                }
            }, [activeTab]);

            const fetchPlatforms = async () => {
                setLoading(true);
                try {
                    const response = await fetch('http://127.0.0.1:5000/api/integration/platforms');
                    const data = await response.json();
                    setPlatforms(data.platforms);
                } catch (error) {
                    console.error('Error fetching platforms:', error);
                } finally {
                    setLoading(false);
                }
            };

            const fetchKnowledgeSources = async () => {
                setLoading(true);
                try {
                    const response = await fetch('http://127.0.0.1:5000/api/integration/knowledge-sources');
                    const data = await response.json();
                    setKnowledgeSources(data.sources);
                } catch (error) {
                    console.error('Error fetching knowledge sources:', error);
                } finally {
                    setLoading(false);
                }
            };

            const handleScrapeUrl = async () => {
                if (!scrapingUrl) {
                    setScrapeStatus('Please enter a URL to scrape');
                    return;
                }

                setLoading(true);
                setScrapeStatus('Scraping...');
                
                try {
                    const response = await fetch('http://127.0.0.1:5000/api/integration/scrape', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ url: scrapingUrl })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        setScrapeStatus(`Success! ${data.chunks} chunks extracted from ${scrapingUrl}`);
                        setScrapingUrl('');
                    } else {
                        setScrapeStatus(`Error: ${data.message || 'Failed to scrape URL'}`);
                    }
                } catch (error) {
                    console.error('Error scraping URL:', error);
                    setScrapeStatus('Error: Failed to connect to the server');
                } finally {
                    setLoading(false);
                }
            };

            const handleCreateWorkflow = async () => {
                if (!workflowDescription) {
                    return;
                }

                setLoading(true);
                
                try {
                    const response = await fetch('http://127.0.0.1:5000/api/integration/create-workflow', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ description: workflowDescription })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        alert(`Workflow created: ${data.workflow.name}`);
                        setWorkflowDescription('');
                    } else {
                        alert(`Error: ${data.message || 'Failed to create workflow'}`);
                    }
                } catch (error) {
                    console.error('Error creating workflow:', error);
                    alert('Error: Failed to connect to the server');
                } finally {
                    setLoading(false);
                }
            };

            const renderContent = () => {
                if (loading) {
                    return (
                        <div className="loading">
                            <div className="spinner"></div>
                        </div>
                    );
                }

                switch (activeTab) {
                    case 'scraper':
                        return (
                            <div>
                                <h2>Knowledge Scraper</h2>
                                <div className="input-group">
                                    <label htmlFor="url">URL to Scrape</label>
                                    <input
                                        id="url"
                                        type="text"
                                        value={scrapingUrl}
                                        onChange={(e) => setScrapingUrl(e.target.value)}
                                        placeholder="https://example.com"
                                    />
                                </div>
                                <button onClick={handleScrapeUrl}>Scrape URL</button>
                                {scrapeStatus && <p>{scrapeStatus}</p>}
                            </div>
                        );
                    case 'workflows':
                        return (
                            <div>
                                <h2>Create Workflow</h2>
                                <div className="input-group">
                                    <label htmlFor="description">Workflow Description</label>
                                    <textarea
                                        id="description"
                                        value={workflowDescription}
                                        onChange={(e) => setWorkflowDescription(e.target.value)}
                                        placeholder="Describe what this workflow should do..."
                                        rows={5}
                                    />
                                </div>
                                <button onClick={handleCreateWorkflow}>Create Workflow</button>
                            </div>
                        );
                    case 'platforms':
                        return (
                            <div>
                                <h2>Integration Platforms</h2>
                                <div className="platform-list">
                                    {platforms.map((platform, index) => (
                                        <div key={index} className="platform-card">
                                            <div className={`platform-icon ${platform.connected ? 'connected' : ''}`}>
                                                {platform.icon.charAt(0).toUpperCase()}
                                            </div>
                                            <div className="platform-name">{platform.name}</div>
                                            <div className="platform-status">
                                                {platform.connected ? 'Connected' : 'Not Connected'}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        );
                    case 'knowledge':
                        return (
                            <div>
                                <h2>Knowledge Sources</h2>
                                <div className="knowledge-list">
                                    {knowledgeSources.map((source, index) => (
                                        <div key={index} className="knowledge-item">
                                            <div className="knowledge-name">{source.name}</div>
                                            <div className="knowledge-url">{source.url}</div>
                                            <div className="knowledge-date">Added: {source.date_added}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        );
                    default:
                        return null;
                }
            };

            return (
                <div className="app-container">
                    <header>
                        <h1>MamaBear Integration Workbench</h1>
                    </header>
                    
                    <div className="tabs">
                        <button 
                            className={`tab ${activeTab === 'scraper' ? 'active' : ''}`}
                            onClick={() => setActiveTab('scraper')}
                        >
                            Knowledge Scraper
                        </button>
                        <button 
                            className={`tab ${activeTab === 'workflows' ? 'active' : ''}`}
                            onClick={() => setActiveTab('workflows')}
                        >
                            Workflows
                        </button>
                        <button 
                            className={`tab ${activeTab === 'platforms' ? 'active' : ''}`}
                            onClick={() => setActiveTab('platforms')}
                        >
                            Platforms
                        </button>
                        <button 
                            className={`tab ${activeTab === 'knowledge' ? 'active' : ''}`}
                            onClick={() => setActiveTab('knowledge')}
                        >
                            Knowledge Base
                        </button>
                    </div>
                    
                    <div className="content">
                        {renderContent()}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<IntegrationWorkbench />, document.getElementById('root'));
    </script>
</body>
</html>
