<!DOCTYPE html>
<html>
<head>
    <title>Direct Origin Socket.IO Test</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
</head>
<body>
    <h1>Direct Origin Socket.IO Test</h1>
    <div id="status" style="padding: 10px; margin: 10px 0; background-color: #f0f0f0;">Connecting...</div>
    <div id="log" style="height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;"></div>

    <script>
        const statusEl = document.getElementById('status');
        const logEl = document.getElementById('log');

        function log(message) {
            const entry = document.createElement('div');
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logEl.appendChild(entry);
            console.log(message);
        }

        log("Script started");

        try {
            // Try with current origin directly
            const url = window.location.origin;
            log(`Trying to connect to current origin: ${url}`);
            statusEl.textContent = `Connecting to ${url}...`;
            
            // Connect with explicit configuration options
            const socket = io(url, {
                path: '/socket.io/',
                transports: ['polling', 'websocket'],
                reconnectionAttempts: 5,
                reconnectionDelay: 1000,
                timeout: 20000
            });
            
            socket.on('connect', () => {
                log(`Connected! Socket ID: ${socket.id}`);
                statusEl.textContent = 'Connected!';
                statusEl.style.backgroundColor = '#d4edda';
                
                // Connection details
                const details = {
                    id: socket.id,
                    transport: socket.io.engine.transport.name,
                    url: socket.io.uri
                };
                log(`Connection details: ${JSON.stringify(details)}`);
            });
            
            socket.on('connect_error', (err) => {
                log(`Connection error: ${err.message}`);
                statusEl.textContent = `Connection error: ${err.message}`;
                statusEl.style.backgroundColor = '#f8d7da';
            });
            
            socket.on('disconnect', (reason) => {
                log(`Disconnected: ${reason}`);
                statusEl.textContent = `Disconnected: ${reason}`;
                statusEl.style.backgroundColor = '#f8d7da';
            });
            
            socket.on('connected', (data) => {
                log(`Server welcome message: ${JSON.stringify(data)}`);
            });
            
            // Add this script to output browser location info
            log(`Document URL: ${document.URL}`);
            log(`Window location: ${window.location.href}`);
            log(`Window location origin: ${window.location.origin}`);
            log(`Window location hostname: ${window.location.hostname}`);
            log(`Window location port: ${window.location.port}`);
            log(`Window location pathname: ${window.location.pathname}`);
            
            log("Socket.IO initialization complete");
            
        } catch (error) {
            log(`Error initializing socket: ${error.message}`);
            statusEl.textContent = `Error: ${error.message}`;
            statusEl.style.backgroundColor = '#f8d7da';
        }
    </script>
</body>
</html>
