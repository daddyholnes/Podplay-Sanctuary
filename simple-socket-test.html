<!DOCTYPE html>
<html>
<head>
    <title>Simple Socket.IO Test</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
</head>
<body>
    <h1>Simple Socket.IO Connection Test</h1>
    <div id="status" style="padding: 10px; margin: 10px 0; background-color: #f0f0f0;">Connecting...</div>
    <div id="log" style="height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;"></div>

    <script>
        const statusEl = document.getElementById('status');
        const logEl = document.getElementById('log');

        function log(message) {
            const entry = document.createElement('div');
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logEl.appendChild(entry);
            console.log(message);
        }

        log("Script started");

        try {
            const url = 'http://localhost:5000';
            log(`Trying to connect to ${url}`);
            statusEl.textContent = `Connecting to ${url}...`;
            
            const socket = io(url);
            
            socket.on('connect', () => {
                log(`Connected! Socket ID: ${socket.id}`);
                statusEl.textContent = 'Connected!';
                statusEl.style.backgroundColor = '#d4edda';
                
                // Connection details
                const details = {
                    id: socket.id,
                    transport: socket.io.engine.transport.name,
                    url: socket.io.uri
                };
                log(`Connection details: ${JSON.stringify(details)}`);
            });
            
            socket.on('connect_error', (err) => {
                log(`Connection error: ${err.message}`);
                statusEl.textContent = `Connection error: ${err.message}`;
                statusEl.style.backgroundColor = '#f8d7da';
            });
            
            socket.on('disconnect', (reason) => {
                log(`Disconnected: ${reason}`);
                statusEl.textContent = `Disconnected: ${reason}`;
                statusEl.style.backgroundColor = '#f8d7da';
            });
            
            socket.on('connected', (data) => {
                log(`Server welcome message: ${JSON.stringify(data)}`);
            });
            
            // Generic event logger
            const originalEmit = socket.emit;
            socket.emit = function() {
                const args = Array.prototype.slice.call(arguments);
                log(`Emitting event: ${args[0]} ${args.length > 1 ? JSON.stringify(args.slice(1)) : ''}`);
                return originalEmit.apply(this, arguments);
            };
            
            // Add event listener to all events
            const originalOn = socket.on;
            socket.on = function(event, handler) {
                if (event !== 'connect' && event !== 'disconnect' && event !== 'connect_error' && event !== 'connected') {
                    const wrappedHandler = function() {
                        log(`Received event: ${event} ${arguments.length > 0 ? JSON.stringify(Array.prototype.slice.call(arguments)) : ''}`);
                        handler.apply(this, arguments);
                    };
                    return originalOn.call(this, event, wrappedHandler);
                } else {
                    return originalOn.call(this, event, handler);
                }
            };
            
            log("Socket.IO initialization complete");
            
        } catch (error) {
            log(`Error initializing socket: ${error.message}`);
            statusEl.textContent = `Error: ${error.message}`;
            statusEl.style.backgroundColor = '#f8d7da';
        }
    </script>
</body>
</html>
